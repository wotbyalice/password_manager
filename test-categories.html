<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CategoryManager Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .test-result { margin: 10px 0; padding: 10px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .categories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .category-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; position: relative; }
        .category-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--category-color, #007bff); }
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .category-name { margin: 0; font-size: 18px; font-weight: 600; }
        .category-count { background: #f8f9fa; padding: 4px 8px; border-radius: 12px; font-size: 12px; }
        .category-description { color: #666; margin: 10px 0; }
        .category-actions { margin-top: 15px; }
        .btn { padding: 6px 12px; margin-right: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .loading-state, .empty-state, .error-state { text-align: center; padding: 40px; }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>CategoryManager Test Page</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Categories Grid</h2>
        <button id="add-category-btn" class="btn">Add Category</button>
        <div id="categories-grid" class="categories-grid"></div>
    </div>

    <script>
        // Mock electronAPI for testing
        window.electronAPI = {
            getCategories: async () => {
                return {
                    success: true,
                    categories: [
                        {
                            id: 1,
                            name: 'Email',
                            description: 'Email accounts and services',
                            color: '#ef4444',
                            passwordCount: 5
                        },
                        {
                            id: 2,
                            name: 'Banking',
                            description: 'Financial services',
                            color: '#059669',
                            passwordCount: 3
                        },
                        {
                            id: 3,
                            name: 'Social Media',
                            description: 'Social networking platforms',
                            color: '#8b5cf6',
                            passwordCount: 8
                        }
                    ]
                };
            }
        };

        // Test results container
        const testResults = document.getElementById('test-results');

        function addTestResult(testName, success, message) {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${testName}:</strong> ${message}`;
            testResults.appendChild(div);
        }

        // Load the categories script
        const script = document.createElement('script');
        script.src = 'src/renderer/js/categories.js';
        script.onload = runTests;
        script.onerror = () => addTestResult('Script Loading', false, 'Failed to load categories.js');
        document.head.appendChild(script);

        async function runTests() {
            try {
                // Test 1: Check if classes are available
                if (window.CategoriesManager && window.CategoryManager) {
                    addTestResult('Class Loading', true, 'CategoriesManager and CategoryManager classes loaded successfully');
                } else {
                    addTestResult('Class Loading', false, 'Classes not found in window object');
                    return;
                }

                // Test 2: Create CategoryManager instance
                let categoryManager;
                try {
                    categoryManager = new window.CategoryManager();
                    addTestResult('Instance Creation', true, 'CategoryManager instance created successfully');
                } catch (error) {
                    addTestResult('Instance Creation', false, `Failed to create instance: ${error.message}`);
                    return;
                }

                // Test 3: Test rendering methods
                try {
                    const mockCategory = {
                        id: 1,
                        name: 'Test Category',
                        description: 'Test description',
                        color: '#ff0000',
                        passwordCount: 5
                    };
                    
                    const cardHtml = categoryManager.renderCategoryCard(mockCategory);
                    if (cardHtml.includes('Test Category') && cardHtml.includes('category-card')) {
                        addTestResult('Card Rendering', true, 'Category card rendered correctly');
                    } else {
                        addTestResult('Card Rendering', false, 'Category card HTML is incorrect');
                    }
                } catch (error) {
                    addTestResult('Card Rendering', false, `Card rendering failed: ${error.message}`);
                }

                // Test 4: Test empty state rendering
                try {
                    const emptyHtml = categoryManager.renderEmptyState();
                    if (emptyHtml.includes('No Categories Yet') && emptyHtml.includes('empty-state')) {
                        addTestResult('Empty State', true, 'Empty state rendered correctly');
                    } else {
                        addTestResult('Empty State', false, 'Empty state HTML is incorrect');
                    }
                } catch (error) {
                    addTestResult('Empty State', false, `Empty state rendering failed: ${error.message}`);
                }

                // Test 5: Test loading categories
                try {
                    await categoryManager.loadCategories();
                    if (categoryManager.categories.length > 0) {
                        addTestResult('Load Categories', true, `Loaded ${categoryManager.categories.length} categories`);
                    } else {
                        addTestResult('Load Categories', false, 'No categories loaded');
                    }
                } catch (error) {
                    addTestResult('Load Categories', false, `Loading failed: ${error.message}`);
                }

                // Test 6: Test grid rendering
                try {
                    categoryManager.renderCategories();
                    const grid = document.getElementById('categories-grid');
                    if (grid.innerHTML.includes('category-card')) {
                        addTestResult('Grid Rendering', true, 'Categories grid rendered with cards');
                    } else {
                        addTestResult('Grid Rendering', false, 'Grid rendering failed or no cards found');
                    }
                } catch (error) {
                    addTestResult('Grid Rendering', false, `Grid rendering failed: ${error.message}`);
                }

                addTestResult('Overall Test', true, 'All CategoryManager tests completed!');

            } catch (error) {
                addTestResult('Test Suite', false, `Test suite failed: ${error.message}`);
            }
        }
    </script>
</body>
</html>
