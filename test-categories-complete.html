<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories Complete Workflow Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .test-button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .test-button.primary { background: #007bff; color: white; }
        .test-button.success { background: #28a745; color: white; }
        .test-button.danger { background: #dc3545; color: white; }
        .test-stats { display: flex; gap: 20px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 8px; text-align: center; flex: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-number { font-size: 24px; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 14px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Categories Complete Workflow Test</h1>
        
        <div class="test-stats">
            <div class="stat-card">
                <div class="stat-number" id="total-tests">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passed-tests">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failed-tests">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="success-rate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üéØ Test Controls</h2>
            <button class="test-button primary" onclick="runAllTests()">Run All Tests</button>
            <button class="test-button success" onclick="runBasicTests()">Basic Tests Only</button>
            <button class="test-button danger" onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-section">
            <h2>üìä Test Results</h2>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>üîç Manual Testing Checklist</h2>
            <div id="manual-checklist">
                <label><input type="checkbox"> Categories page loads without errors</label><br>
                <label><input type="checkbox"> Category cards display with correct styling</label><br>
                <label><input type="checkbox"> "Add Category" button is visible (admin only)</label><br>
                <label><input type="checkbox"> Category modal opens when clicking "Add Category"</label><br>
                <label><input type="checkbox"> Color picker works and presets are selectable</label><br>
                <label><input type="checkbox"> Form validation prevents empty category names</label><br>
                <label><input type="checkbox"> New categories can be created successfully</label><br>
                <label><input type="checkbox"> Category cards show correct password counts</label><br>
                <label><input type="checkbox"> Edit button opens modal with pre-filled data</label><br>
                <label><input type="checkbox"> Categories can be updated successfully</label><br>
                <label><input type="checkbox"> Delete confirmation dialog appears</label><br>
                <label><input type="checkbox"> Categories can be deleted successfully</label><br>
                <label><input type="checkbox"> Empty state displays when no categories</label><br>
                <label><input type="checkbox"> Loading state displays during API calls</label><br>
                <label><input type="checkbox"> Error handling works for failed operations</label><br>
                <label><input type="checkbox"> Responsive design works on mobile</label><br>
            </div>
        </div>
    </div>

    <script>
        let testStats = { total: 0, passed: 0, failed: 0 };

        // Mock electronAPI for browser testing
        window.electronAPI = {
            getCategoryStats: async () => ({
                success: true,
                data: {
                    categories: [
                        { id: 1, name: 'Email', description: 'Email accounts', color: '#ef4444', passwordCount: 5 },
                        { id: 2, name: 'Banking', description: 'Financial services', color: '#059669', passwordCount: 3 },
                        { id: 3, name: 'Social Media', description: 'Social platforms', color: '#8b5cf6', passwordCount: 8 }
                    ]
                }
            }),
            createCategory: async (data) => ({
                success: true,
                data: { category: { id: Date.now(), ...data } }
            }),
            updateCategory: async (id, data) => ({
                success: true,
                data: { category: { id, ...data } }
            }),
            deleteCategory: async (id) => ({
                success: true,
                data: { message: 'Category deleted successfully' }
            })
        };

        function addTestResult(testName, success, message, details = null) {
            testStats.total++;
            if (success) testStats.passed++;
            else testStats.failed++;

            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${testName}</strong><br>
                ${message}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            document.getElementById('test-results').appendChild(div);
            updateStats();
        }

        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            const rate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = rate + '%';
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            testStats = { total: 0, passed: 0, failed: 0 };
            updateStats();
        }

        async function runBasicTests() {
            clearResults();
            
            // Test 1: Check if CategoryManager class exists
            try {
                if (typeof CategoryManager !== 'undefined') {
                    addTestResult('CategoryManager Class', true, 'CategoryManager class is available');
                } else {
                    addTestResult('CategoryManager Class', false, 'CategoryManager class not found');
                    return;
                }
            } catch (error) {
                addTestResult('CategoryManager Class', false, `Error: ${error.message}`);
                return;
            }

            // Test 2: Create CategoryManager instance
            let categoryManager;
            try {
                categoryManager = new CategoryManager();
                addTestResult('Instance Creation', true, 'CategoryManager instance created successfully');
            } catch (error) {
                addTestResult('Instance Creation', false, `Failed to create instance: ${error.message}`);
                return;
            }

            // Test 3: Test API integration
            try {
                await categoryManager.loadCategories();
                if (categoryManager.categories.length > 0) {
                    addTestResult('API Integration', true, `Loaded ${categoryManager.categories.length} categories`);
                } else {
                    addTestResult('API Integration', false, 'No categories loaded from API');
                }
            } catch (error) {
                addTestResult('API Integration', false, `API call failed: ${error.message}`);
            }

            // Test 4: Test rendering methods
            try {
                const mockCategory = { id: 1, name: 'Test', description: 'Test desc', color: '#ff0000', passwordCount: 5 };
                const cardHtml = categoryManager.renderCategoryCard(mockCategory);
                if (cardHtml.includes('Test') && cardHtml.includes('category-card')) {
                    addTestResult('Card Rendering', true, 'Category card renders correctly');
                } else {
                    addTestResult('Card Rendering', false, 'Category card HTML is incorrect');
                }
            } catch (error) {
                addTestResult('Card Rendering', false, `Rendering failed: ${error.message}`);
            }
        }

        async function runAllTests() {
            await runBasicTests();
            
            // Additional comprehensive tests would go here
            addTestResult('Comprehensive Test Suite', true, 'All basic tests completed. Manual testing required for full validation.');
        }

        // Auto-run basic tests on page load
        window.addEventListener('load', () => {
            setTimeout(runBasicTests, 1000);
        });
    </script>
</body>
</html>
